{
  "version": 3,
  "sources": ["../../../node_modules/prosemirror-dropcursor/src/dropcursor.js"],
  "sourcesContent": ["import {Plugin} from \"prosemirror-state\"\nimport {dropPoint} from \"prosemirror-transform\"\n\n// :: (options: ?Object) \u2192 Plugin\n// Create a plugin that, when added to a ProseMirror instance,\n// causes a decoration to show up at the drop position when something\n// is dragged over the editor.\n//\n//   options::- These options are supported:\n//\n//     color:: ?string\n//     The color of the cursor. Defaults to `black`.\n//\n//     width:: ?number\n//     The precise width of the cursor in pixels. Defaults to 1.\n//\n//     class:: ?string\n//     A CSS class name to add to the cursor element.\nexport function dropCursor(options = {}) {\n  return new Plugin({\n    view(editorView) { return new DropCursorView(editorView, options) }\n  })\n}\n\nclass DropCursorView {\n  constructor(editorView, options) {\n    this.editorView = editorView\n    this.width = options.width || 1\n    this.color = options.color || \"black\"\n    this.class = options.class\n    this.cursorPos = null\n    this.element = null\n    this.timeout = null\n\n    this.handlers = [\"dragover\", \"dragend\", \"drop\", \"dragleave\"].map(name => {\n      let handler = e => this[name](e)\n      editorView.dom.addEventListener(name, handler)\n      return {name, handler}\n    })\n  }\n\n  destroy() {\n    this.handlers.forEach(({name, handler}) => this.editorView.dom.removeEventListener(name, handler))\n  }\n\n  update(editorView, prevState) {\n    if (this.cursorPos != null && prevState.doc != editorView.state.doc) this.updateOverlay()\n  }\n\n  setCursor(pos) {\n    if (pos == this.cursorPos) return\n    this.cursorPos = pos\n    if (pos == null) {\n      this.element.parentNode.removeChild(this.element)\n      this.element = null\n    } else {\n      this.updateOverlay()\n    }\n  }\n\n  updateOverlay() {\n    let $pos = this.editorView.state.doc.resolve(this.cursorPos), rect\n    if (!$pos.parent.inlineContent) {\n      let before = $pos.nodeBefore, after = $pos.nodeAfter\n      if (before || after) {\n        let nodeRect = this.editorView.nodeDOM(this.cursorPos - (before ?  before.nodeSize : 0)).getBoundingClientRect()\n        let top = before ? nodeRect.bottom : nodeRect.top\n        if (before && after)\n          top = (top + this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top) / 2\n        rect = {left: nodeRect.left, right: nodeRect.right, top: top - this.width / 2, bottom: top + this.width / 2}\n      }\n    }\n    if (!rect) {\n      let coords = this.editorView.coordsAtPos(this.cursorPos)\n      rect = {left: coords.left - this.width / 2, right: coords.left + this.width / 2, top: coords.top, bottom: coords.bottom}\n    }\n\n    let parent = this.editorView.dom.offsetParent\n    if (!this.element) {\n      this.element = parent.appendChild(document.createElement(\"div\"))\n      if (this.class) this.element.className = this.class\n      this.element.style.cssText = \"position: absolute; z-index: 50; pointer-events: none; background-color: \" + this.color\n    }\n    let parentLeft, parentTop\n    if (!parent || parent == document.body && getComputedStyle(parent).position == \"static\") {\n      parentLeft = -pageXOffset\n      parentTop = -pageYOffset\n    } else {\n      let rect = parent.getBoundingClientRect()\n      parentLeft = rect.left - parent.scrollLeft\n      parentTop = rect.top - parent.scrollTop\n    }\n    this.element.style.left = (rect.left - parentLeft) + \"px\"\n    this.element.style.top = (rect.top - parentTop) + \"px\"\n    this.element.style.width = (rect.right - rect.left) + \"px\"\n    this.element.style.height = (rect.bottom - rect.top) + \"px\"\n  }\n\n  scheduleRemoval(timeout) {\n    clearTimeout(this.timeout)\n    this.timeout = setTimeout(() => this.setCursor(null), timeout)\n  }\n\n  dragover(event) {\n    if (!this.editorView.editable) return\n    let pos = this.editorView.posAtCoords({left: event.clientX, top: event.clientY})\n    if (pos) {\n      let target = pos.pos\n      if (this.editorView.dragging && this.editorView.dragging.slice) {\n        target = dropPoint(this.editorView.state.doc, target, this.editorView.dragging.slice)\n        if (target == null) target = pos.pos\n      }\n      this.setCursor(target)\n      this.scheduleRemoval(5000)\n    }\n  }\n\n  dragend() {\n    this.scheduleRemoval(20)\n  }\n\n  drop() {\n    this.scheduleRemoval(20)\n  }\n\n  dragleave(event) {\n    if (event.target == this.editorView.dom || !this.editorView.dom.contains(event.relatedTarget))\n      this.setCursor(null)\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
